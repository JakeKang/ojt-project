# 인메모리 스토리지 개념과 종류

## 정의
__모든 데이터를 메모리(RAM)에만 올려 놓고 사용하는 데이터베이스의 일종이다.__

일반적인 데이터베이스(RDBMS)는 디스크(HDD, SSD)에 데이터를 영구적으로 저장해 놓고, 필요한 데이터만 메모리에 읽어서 사용한다.

인 메모리 캐시는 디스크에 접근하지 않고 메모리로만 모든 처리를 하기 때문에 데이터 저장 및 검색 속도가 매우 빠르다.

단 데이터는 딱 메모리 크기까지만 저장할 수 있다.
또한, 메모리에만 저장되어 있기 때문에 서버의 전원 공급이 중단되면 데이터는 소멸된다.

보통 빠른 처리 속도를 위해 데이터베이스에 저장된 데이터 중 쿼리 결과나 자주 사용되는 데이터를 인 메모리 캐시에 임시로 저장한다.


### 들어가기 앞서 NOSQL에 대해 알아보자.
RDBMS는 보통 "관계형 데이터베이스"라고 하며 NOSQL은 "비관계형 데이터베이스"이다.
보통 NOSQL은 키-밸류나 컬럼, 문서 형식의 데이터 모델을 이용한다.

RDBMS가 아닌 다른 형태로 데이터를 저장하는 기술이라고 생각하면 된다.

__NOSQL: Not Only SQL, 비관계형 데이터베이스__

아주 많은 양의 ==데이터를 효율적으로 처리==가 필요할 때, ==데이터의 분산처리, 빠른쓰기== 및 ==데이터의 안정성==이 필요할 때 사용한다.
특정 서버에 장애가 발생했을 때에도 데이터 유실이나 서비스 중지가 없는 형태의 구조이기 때문에 NOSQL을 사용한다.

### NOSQL의 종류
1. 키-밸류 스토리지형 키-밸류형 : ==Redis==, memcached, Oracle, Coherence
2. 열 지향 와이드 컬럼 스토어 : Cassandra, HBASE, Cloud Database
3. 문서형 : MongoDB, Couchbase, MarkLogic, PostgreSQL, MySQL, DynamicDB MS-DocumentDB
4. 그래프형 : Neo4j

## 종류

### Memcached
__명료하고 단순함을 위해 개발__

멀티스레드를 지원하기 때문에, 멀티프로세스코어를 사용할 수 있다.
따라서, 스케일업을 통하여 더욱 많은 작업처리를 할 수 있다.

- 처리 속도가 빠르다.
  데이터가 메모리에만 저장되므로 빠르다. 즉, 속도가 느린 Disk를 거치지 않는다.
- 데이터가 메모리에만 저장된다.
  프로세스가 죽거나 장비가 Shutdown 되면 데이터가 사라진다.
- 만료일을 지정하여 만료가 되면 자동으로 데이터가 사라진다. (Cache 특성)
- 저장소 메모리 재사용
  만료가 되지 않았더라도 더 이상 데이터를 넣을 메모리가 없으면 LRU(Least recently used) 알고리즘에 의해 데이터가 사라진다.

### Redis
__다양한 용도에 효과적으로 사용할 수 있도록 많은 특징__

싱글 쓰레드이기 때문에, 1번에 1개의 명령어만 실행할 수 있다.

- REDIS(REmote Dictionary Server)는 메모리 기반의 "키-값" 구조 데이터 관리 시스템이다.
- 모든 데이터를 메모리에 저장하고 조회하기에 빠른 읽기 쓰기 속도를 보장하는 ==비 관계형 데이터베이스== 이다.

크게 <String, Set, Sorted Set, Hash, List>의 데이터 형식을 지원한다.

빠른 오픈 소스 인 메모리 키-값 데이터 구조 스토어이며, 다양한 인메모리 데이터 구조 집합을 제공하므로 사용자 정의 애플리케이션을 손쉽게 생성할 수 있다.

#### 특징
- 영속성을 지원하는 인메모리 데이터 저장소.
- 읽기 성능 증대를 위한 서버 측 복제를 지원한다.
- 쓰기 성능 증대를 위한 클라이언트 측 샤딩(Sharding)을 지원한다.

###### 샤딩이란?
파티셔닝과 동일하다. 같은 테이블 스키마를 가진 데이터를 다수의 데이터베이스에 분산하여 저장하는 방법을 의미한다.

#### 장점
- 리스트, 배열과 같은 데이터를 처리하는데 유용하다.
- 리스트형 데이터 입력과 삭제가 MySQL에 비해서 10배정도 빠르다고 한다.
- 메모리를 활용하면서 영속적인 데이터 보존이 가능하다.
  명령어로 명시적으로 삭제, expires를 설정하지 않으면 데이터가 삭제되지 않는다.
  - Redis Server는 1개의 싱글 쓰레드로 수행되며, 따라서 서버 하나에 여러개의 서버를 띄우는 것이 가능하다.

### 데이터 타입
1. String
    - 일반적인 문자열로 최대 512MB 길이 까지 지원한다.
    - Text 문자열 뿐만 아니라 Integer와 같은 숫자나 JPEG같은 Binary File까지 저장할 수 있다.

2. Set
    - Set은 String의 집합이다. 여러개의 값을 하나의 Value 내에 넣을 수 있다고 생각하면 된다.
    - 블로그 포스트의 태깅(Tag)등에 사용될 수 있다.
    - Set간의 연산을 지원하는데, 집합인 만큼 교집합, 합집합, 차이를 빠른 시간내에 추출할 수 있다.

|Set |
|----|
|Members|
|Members|
|Members|

3. Sorted Set
    - Set에 "score" 라는 필드가 추가된 데이터 형으로 score는 일종의 "가중치" 정도이다.
    - 데이터는 오름 차순으로 내부 정렬되며, 정렬이 되어 있는 만큼 score 값 범위에 따른 쿼리나(range), top rank에 따른 쿼리 등이 가능하다.

|Sorted Set||
|----|----|
|score|Member|
|score|Member|
|score|Member|

4. Hash
    - value내에 filed/string value 쌍으로 이루어진 테이블을 저장하는 데이터 구조체이다.
    - RDBMS에서 PK 1개와 string 필드 하나로 이루어진 테이블이라고 이해하면 된다.

5. List
    - string들이 집합으로 저장되는 데이터 형태이다.
    - Set과 유사하지만, 양방향 Linked List라고 생각하면 된다.
    - List 앞과 뒤에서 PUSH/POP 연산을 이용해서 데이터를 넣거나 뺄 수 있다.
    - 지정된 INDEX 값을 이용하여 지정된 위치에 데이터를 넣거나 뺄 수 있다.

출처 [Memcached, Redis](https://brownbears.tistory.com/43)

### Memcached와 Redis 비교
|차이|Memcached|Redis|
|:----:|:---------:|:-----:|
|처리속도| 처리 속도가 빠르다.</br> 당연히 데이터가 메모리에만 저장되니 빠를 수 밖에 없다. </br> 디스크를 거치지 않는다. | 처리 속도가 빠르다. </br> 디스크와 메모리에 저장되는데도 Memcached와 차이가 없다.|
|데이터 저장| 데이터가 ==메모리에만 저장==된다. </br> 프로세스가 죽거나 장비를 끄는 즉시 데이터는 사라진다. | 데이터는 ==메모리와 디스크에 저장== 되서 </br> 불의의 경우에도 데이터 복구가 가능하다.|
|만료일 지정| 만료일을 지정해서 만료시 데이터는 캐시처럼 영원히 사라진다. | 동일하다. |
|메모리 재사용| 저장소 메모리를 재사용한다. </br> 만료전에도 더 이상 데이터를 넣을 메모리가 없으면 LRU 알고리즘을 따라 데이터는 사라진다. | 저장소 메모리 재사용 없음 </br> 명시적으로만 데이터 제거 가능|
|데이터 타입| 문자열만 지원 | 문자열, Set, Sorted Set, Hash, List 데이터 타입 지원|

출처 [레디스란 무엇인가?](https://medium.com/@jyejye9201/%EB%A0%88%EB%94%94%EC%8A%A4-redis-%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-2b7af75fa818)